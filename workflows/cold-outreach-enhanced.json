{
  "name": "Sportbiztos√≠t√°s Cold Outreach - ENHANCED",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 0 10 * * 2-4"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [100, 300],
      "id": "schedule-trigger",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "options": {}
      },
      "id": "google-sheets-read",
      "name": "Read Contacts from Sheet",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [500, 300],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "",
          "name": "Google Sheets account"
        }
      },
      "notes": "‚ö†Ô∏è FONTOS: √Åll√≠tsd be a saj√°t Google Sheet URL-edet!"
    },
    {
      "parameters": {
        "jsCode": "// ‚úÖ Email form√°tum valid√°l√°s\n// Csak a valid email c√≠mekkel rendelkez≈ë sorokat engedj√ºk tov√°bb\n\nconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\nreturn items.filter(item => {\n  const email = item.json.Email || item.json['e-mail c√≠m'] || item.json['e-mail c√≠m '];\n  \n  // Ellen≈ërizz√ºk hogy van-e email c√≠m\n  if (!email) {\n    console.log(`‚ùå Hi√°nyz√≥ email: ${item.json.N√©v || item.json['N√©v ']}`);\n    return false;\n  }\n  \n  // Valid√°ljuk az email form√°tumot\n  if (!emailRegex.test(String(email).trim())) {\n    console.log(`‚ùå √ârv√©nytelen email form√°tum: ${email}`);\n    return false;\n  }\n  \n  // Ellen≈ërizz√ºk hogy van-e n√©v\n  const nev = item.json.N√©v || item.json['N√©v '];\n  if (!nev || String(nev).trim() === '') {\n    console.log(`‚ùå Hi√°nyz√≥ n√©v`);\n    return false;\n  }\n  \n  return true;\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [700, 300],
      "id": "validate-emails",
      "name": "Validate Emails"
    },
    {
      "parameters": {
        "jsCode": "// Csak azokat a sorokat engedj√ºk tov√°bb,\n// ahol a \"K√ºldve\" oszlop √ºres vagy nincs kit√∂ltve.\n\nreturn items.filter(item => {\n  // A Google Sheets header neve pontosan: \"K√ºldve\"\n  const status = item.json[\"K√ºldve\"];\n\n  // Ha nincs √©rt√©k, vagy csak whitespace ‚Üí K√úLDHET≈ê\n  if (!status || String(status).trim() === \"\") {\n    return true;\n  }\n\n  // Ha m√°r van benne √©rt√©k (pl. \"k√ºldve\" vagy timestamp) ‚Üí NE k√ºldje √∫jra\n  return false;\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300],
      "id": "filter-unsent",
      "name": "Filter Unsent Contacts"
    },
    {
      "parameters": {
        "batchSize": 50,
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [1100, 300],
      "id": "rate-limit",
      "name": "Rate Limit (50/batch)"
    },
    {
      "parameters": {
        "sendTo": "={{ $json.Email || $json['e-mail c√≠m'] || $json['e-mail c√≠m '] }}",
        "subject": "Sportpajzs ‚Äì r√∂vid bemutatkoz√°s",
        "message": "=<!DOCTYPE html>\n<html lang=\"hu\">\n<head>\n<meta charset=\"UTF-8\">\n<title>Sportpajzs ‚Äì bemutatkoz√°s</title>\n</head>\n<body style=\"font-family: Arial, sans-serif; color:#222; line-height:1.5;\">\n\n<p><strong>Tisztelt {{ $json.N√©v || $json['N√©v '] }}!</strong></p>\n\n<p>\nSzeretn√©m r√∂viden bemutatni a Sportpajzsot.  \nA lenti weboldalon megismerheti, hogyan ny√∫jtunk v√©delmet hobbist√°knak, amat≈ër √©s profi sportol√≥knak,\nilletve mindenkinek, aki akt√≠v √©letet √©l:\n</p>\n\n<p>\nüëâ <a href=\"https://sportpajzs.hu/\" target=\"_blank\">https://sportpajzs.hu/</a>\n</p>\n\n<p>\nSokan √∫gy gondolj√°k, hogy a bankk√°rty√°hoz vagy lak√°sbiztos√≠t√°shoz k√∂t√∂tt balesetbiztos√≠t√°s majd ‚Äû√∫gyis seg√≠t‚Äù.\nA val√≥s√°gban ezek legt√∂bbsz√∂r csak minim√°lis √∂sszeget fizetnek ‚Äì pont akkor, amikor a gyors √©s val√≥di t√°mogat√°s lenne a legfontosabb.\n</p>\n\n<p>\nEgy egyszer≈± p√©lda: ha valaki rendszeresen fut, kimegy az erd≈ëbe √©s egy rossz l√©p√©s ut√°n kimegy vagy elt√∂rik a bok√°ja,\na vizsg√°latok, r√∂ntgen √©s kontrollok ak√°r t√∂bb t√≠zezer forintot is jelenthetnek.\nA mi megold√°saink ilyen helyzetekben val√≥di, azonnal √©rezhet≈ë seg√≠ts√©get ny√∫jtanak.\n</p>\n\n<p>\nHa k√©rd√©se van, sz√≠vesen seg√≠t√ºnk ‚Äì telefonon vagy e-mailben is b√°rmikor bizalommal fordulhat hozz√°nk.\nEmellett egy√ºttm≈±k√∂d√©si lehet≈ës√©get is k√≠n√°lunk: partnereinket felt√ºntetj√ºk weboldalunkon.\n</p>\n\n<br><br>\n\n<p>√údv√∂zlettel,<br>\n<strong>Sportpajzs csapata</strong></p>\n\n<img src=\"https://lh3.googleusercontent.com/d/1ZKugX-lOqelGhnlByHNwx51H11BcnuGM=s150\"\n     alt=\"Sportpajzs pecs√©t\"\n     style=\"width:150px; height:auto; display:block; margin-top:10px;\">\n\n</body>\n</html>\n",
        "options": {}
      },
      "id": "gmail-send",
      "name": "Send Intro Email",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [1300, 300],
      "credentials": {
        "gmailOAuth2": {
          "id": "",
          "name": "Sportpajzs Gmail"
        }
      },
      "notes": "‚ö†Ô∏è FONTOS: √Åll√≠tsd be a saj√°t Gmail credential-edet!"
    },
    {
      "parameters": {
        "jsCode": "// ‚úÖ Id≈ëb√©lyeg gener√°l√°s\n// Form√°tum: 2025-12-03 10:00:15\n\nconst now = new Date();\nconst timestamp = now.toLocaleString('hu-HU', {\n  year: 'numeric',\n  month: '2-digit',\n  day: '2-digit',\n  hour: '2-digit',\n  minute: '2-digit',\n  second: '2-digit',\n  hour12: false\n}).replace(',', '');\n\n// Hozz√°adjuk a timestampet az itemhez\nreturn items.map(item => {\n  return {\n    json: {\n      ...item.json,\n      kuldve_timestamp: timestamp,\n      sikeres: true\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1500, 300],
      "id": "format-timestamp",
      "name": "Format Timestamp"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "K√ºldve": "={{ $json.kuldve_timestamp }}"
          },
          "matchingColumns": ["ID"],
          "schema": [
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "N√©v",
              "displayName": "N√©v",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Email",
              "displayName": "Email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "T√≠pus",
              "displayName": "T√≠pus",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "K√ºldve",
              "displayName": "K√ºldve",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false
            },
            {
              "id": "V√°lasz",
              "displayName": "V√°lasz",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false
            },
            {
              "id": "Megjegyz√©s",
              "displayName": "Megjegyz√©s",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [1700, 300],
      "id": "update-sheet",
      "name": "Mark as Sent",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "",
          "name": "Google Sheets account"
        }
      },
      "notes": "‚ö†Ô∏è FONTOS: Ugyanaz a Sheet credential mint a Read node-ban!"
    },
    {
      "parameters": {
        "jsCode": "// ‚úÖ V√©grehajt√°s napl√≥z√°s\n// √ñsszes√≠tj√ºk h√°ny emailt k√ºldt√ºnk\n\nconst totalSent = items.length;\nconst timestamp = new Date().toLocaleString('hu-HU');\n\nconsole.log(`‚úÖ Sikeres v√©grehajt√°s: ${totalSent} email elk√ºldve - ${timestamp}`);\n\n// Visszaadjuk az √∂sszes√≠t√©st\nreturn [{\n  json: {\n    sikeres_darab: totalSent,\n    datum: timestamp,\n    statusz: 'sikeres'\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1900, 300],
      "id": "log-execution",
      "name": "Log Execution"
    },
    {
      "parameters": {
        "jsCode": "// ‚ùå Hiba kezel√©s - Sheet olvas√°s\n// Ez a node akkor fut le, ha a Google Sheets Read node hib√°t dob\n\nconst error = $('Read Contacts from Sheet').error;\n\nconst errorMessage = `\n‚ùå HIBA: Google Sheets olvas√°s sikertelen!\n\nüìã R√©szletek:\n- Id≈ëpont: ${new Date().toLocaleString('hu-HU')}\n- Hiba t√≠pus: ${error?.message || 'Ismeretlen hiba'}\n- Workflow: Sportbiztos√≠t√°s Cold Outreach\n\nüîß Lehets√©ges okok:\n1. Google Sheets OAuth lej√°rt ‚Üí √öjra-enged√©lyez√©s sz√ºks√©ges\n2. Sheet t√∂r√∂lve vagy √°thelyezve\n3. Nincs hozz√°f√©r√©si jog a sheet-hez\n4. Sheet URL megv√°ltozott\n\nüí° Mit tegy√©l:\n1. n8n ‚Üí Credentials ‚Üí Google Sheets account ‚Üí Reauthorize\n2. Ellen≈ërizd hogy a Sheet URL helyes\n3. Ellen≈ërizd a Google Sheet hozz√°f√©r√©si jogokat\n`;\n\nreturn [{\n  json: {\n    hiba_tipus: 'sheet_olvasas',\n    uzenet: errorMessage,\n    workflow: 'Cold Outreach',\n    datum: new Date().toISOString()\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [700, 500],
      "id": "error-sheet-read",
      "name": "Error: Sheet Read Failed"
    },
    {
      "parameters": {
        "jsCode": "// ‚ùå Hiba kezel√©s - Email k√ºld√©s\n// Ez a node akkor fut le, ha a Gmail Send node hib√°t dob\n\nconst error = $('Send Intro Email').error;\nconst failedContact = $input.first()?.json;\n\nconst errorMessage = `\n‚ùå HIBA: Email k√ºld√©s sikertelen!\n\nüìã R√©szletek:\n- Id≈ëpont: ${new Date().toLocaleString('hu-HU')}\n- Hiba t√≠pus: ${error?.message || 'Ismeretlen hiba'}\n- Sikertelen kontakt: ${failedContact?.N√©v || failedContact?.['N√©v '] || 'N/A'}\n- Email c√≠m: ${failedContact?.Email || failedContact?.['e-mail c√≠m'] || failedContact?.['e-mail c√≠m '] || 'N/A'}\n- Workflow: Sportbiztos√≠t√°s Cold Outreach\n\nüîß Lehets√©ges okok:\n1. Gmail OAuth lej√°rt ‚Üí √öjra-enged√©lyez√©s sz√ºks√©ges\n2. Napi email limit el√©rve (500/nap)\n3. √ârv√©nytelen email c√≠m\n4. Gmail fi√≥k blokkolva vagy felf√ºggesztve\n\nüí° Mit tegy√©l:\n1. n8n ‚Üí Credentials ‚Üí Sportpajzs Gmail ‚Üí Reauthorize\n2. Ellen≈ërizd a Gmail fi√≥k st√°tusz√°t\n3. N√©zd meg h√°ny emailt k√ºldt√©l ma (limit: 500/nap)\n4. Ellen≈ërizd az email c√≠m form√°tum√°t\n`;\n\nreturn [{\n  json: {\n    hiba_tipus: 'email_kuldes',\n    uzenet: errorMessage,\n    workflow: 'Cold Outreach',\n    datum: new Date().toISOString(),\n    sikertelen_kontakt: failedContact\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1500, 500],
      "id": "error-email-send",
      "name": "Error: Email Send Failed"
    },
    {
      "parameters": {
        "sendTo": "czunidaniel9@gmail.com",
        "subject": "‚ö†Ô∏è n8n Workflow Hiba - Cold Outreach",
        "message": "={{ $json.uzenet }}",
        "options": {}
      },
      "id": "send-error-alert",
      "name": "Send Error Alert to Dani",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [1100, 600],
      "credentials": {
        "gmailOAuth2": {
          "id": "",
          "name": "Personal Gmail"
        }
      },
      "notes": "Ez a szem√©lyes Gmail fi√≥kodr√≥l k√ºldi az √©rtes√≠t√©st!"
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Read Contacts from Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Contacts from Sheet": {
      "main": [
        [
          {
            "node": "Validate Emails",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Emails": {
      "main": [
        [
          {
            "node": "Filter Unsent Contacts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Unsent Contacts": {
      "main": [
        [
          {
            "node": "Rate Limit (50/batch)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limit (50/batch)": {
      "main": [
        [
          {
            "node": "Send Intro Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Intro Email": {
      "main": [
        [
          {
            "node": "Format Timestamp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Timestamp": {
      "main": [
        [
          {
            "node": "Mark as Sent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark as Sent": {
      "main": [
        [
          {
            "node": "Log Execution",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Contacts from Sheet": {
      "main": [
        [
          {
            "node": "Validate Emails",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error: Sheet Read Failed",
            "type": "error",
            "index": 0
          }
        ]
      ]
    },
    "Send Intro Email": {
      "main": [
        [
          {
            "node": "Format Timestamp",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error: Email Send Failed",
            "type": "error",
            "index": 0
          }
        ]
      ]
    },
    "Error: Sheet Read Failed": {
      "main": [
        [
          {
            "node": "Send Error Alert to Dani",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error: Email Send Failed": {
      "main": [
        [
          {
            "node": "Send Error Alert to Dani",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "timezone": "Europe/Budapest",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "",
  "meta": {
    "templateCredsSetupCompleted": false
  },
  "id": "",
  "tags": []
}
